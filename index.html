<!DOCTYPE html>
<html>
<body>

<p>Click the button to get your coordinates.</p>

<button onclick="getLocation()">Try It</button>

<p id="coords"></p>

<p id="masies"></p>

<p id="activitats"></p>

<script>
var x = document.getElementById("coords");
var y = document.getElementById("masies");
var z = document.getElementById("activitats");

const gpsopts = {enableHighAccuracy: true, timeout: 6000, maximumAge: 0};

function prova(data) {
	
	text = '';
	for (let i = 0, len = data.elements.length; i < len; i++) {
		let adreca = JSON.stringify(data.elements[i].adreca_nom);
		let descripcio = JSON.stringify(data.elements[i].descripcio);
 		text += "<b>"+adreca+"</b><br>"+descripcio+"<br>";
	y.innerHTML = text;
	}			
	
	}

function gpserror(err) {
    document.write('No es pot connectar amb el servidor...');
}


function getLocation() {

  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(showPosition, gpserror, gpsopts);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }

}
    
function showPosition(position) {
	x.innerHTML="Latitude: " + position.coords.latitude + 
	"<br>Longitude: " + position.coords.longitude +
	"<br>";
	
	let url = 'https://do.diba.cat/api/dataset/masies/ubicacio/'+position.coords.latitude+','+position.coords.longitude+'/geocamp/localitzacio/radi/300';
	
	fetch(url)
	  .then(res => res.json()) // the .json() method parses the JSON response into a JS object literal
	  .then(data => prova(data));
	}

</script>

</body>
</html>
