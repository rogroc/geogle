<!DOCTYPE html>
<html>
<body>

<p>Click the button to get your coordinates.</p>

<button onclick="getLocation()">Try It</button>

<p id="coords"></p>

<p id="cos"></p>

<script>
var x = document.getElementById("coords");
var y = document.getElementById("cos");

function prova(data) {
	document.body.innerHTML = "Resultats:<br>";
	for (let i = 0, len = data.elements.length; i < len; i++) {
		let adreca = JSON.stringify(data.elements[i].adreca_nom);
		let descripcio = JSON.stringify(data.elements[i].descripcio);
 		document.write("<b>"+adreca+"</b><br>"+descripcio+"<br>");
	}		
	}

function getLocation() {

  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(showPosition, enableHighAccuracy: true);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}
    
function showPosition(position) {
    let url = 'https://do.diba.cat/api/dataset/masies/ubicacio/'+position.coords.latitude+','+position.coords.longitude+'/geocamp/localitzacio/radi/500';

    x.innerHTML="Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude +
    "<br>";

fetch(url)
  .then(res => res.json()) // the .json() method parses the JSON response into a JS object literal
  .then(data => prova(data));

}

</script>

</body>
</html>
